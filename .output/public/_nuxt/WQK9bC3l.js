import{m as $,D as P,P as z,l as C,aa as K,r as S,ab as q,ac as B,ad as Q,ae as X,af as Y,p as T,ag as x,h as Z}from"./DY1PNkpc.js";function ee(e){return Q()?(X(e),!0):!1}const te=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ne=Object.prototype.toString,re=e=>ne.call(e)==="[object Object]",oe=()=>{};function se(...e){if(e.length!==1)return K(...e);const t=e[0];return typeof t=="function"?z(q(()=>({get:t,set:oe}))):S(t)}function ue(e,t){function n(...a){return new Promise((i,p)=>{Promise.resolve(e(()=>t.apply(this,a),{fn:t,thisArg:this,args:a})).then(i).catch(p)})}return n}const D=e=>e();function ae(e=D,t={}){const{initialState:n="active"}=t,a=se(n==="active");function i(){a.value=!1}function p(){a.value=!0}const h=(...l)=>{a.value&&e(...l)};return{isActive:z(a),pause:i,resume:p,eventFilter:h}}function U(e){return Array.isArray(e)?e:[e]}function le(e){return B()}function ie(e,t,n={}){const{eventFilter:a=D,...i}=n;return C(e,ue(a,t),i)}function ce(e,t,n={}){const{eventFilter:a,initialState:i="active",...p}=n,{eventFilter:h,pause:l,resume:c,isActive:f}=ae(a,{initialState:i});return{stop:ie(e,t,{...p,eventFilter:h}),pause:l,resume:c,isActive:f}}function fe(e,t=!0,n){le()?$(e,n):t?e():P(e)}function pe(e,t,n){return C(e,t,{...n,immediate:!0})}const R=te?window:void 0;function de(e){var t;const n=x(e);return(t=n==null?void 0:n.$el)!=null?t:n}function M(...e){const t=[],n=()=>{t.forEach(l=>l()),t.length=0},a=(l,c,f,g)=>(l.addEventListener(c,f,g),()=>l.removeEventListener(c,f,g)),i=T(()=>{const l=U(x(e[0])).filter(c=>c!=null);return l.every(c=>typeof c!="string")?l:void 0}),p=pe(()=>{var l,c;return[(c=(l=i.value)==null?void 0:l.map(f=>de(f)))!=null?c:[R].filter(f=>f!=null),U(x(i.value?e[1]:e[0])),U(Z(i.value?e[2]:e[1])),x(i.value?e[3]:e[2])]},([l,c,f,g])=>{if(n(),!(l!=null&&l.length)||!(c!=null&&c.length)||!(f!=null&&f.length))return;const b=re(g)?{...g}:g;t.push(...l.flatMap(s=>c.flatMap(u=>f.map(m=>a(s,u,m,b)))))},{flush:"post"}),h=()=>{p(),n()};return ee(n),h}const j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},F="__vueuse_ssr_handlers__",ve=ye();function ye(){return F in j||(j[F]=j[F]||{}),j[F]}function he(e,t){return ve[e]||t}function ge(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const ke={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},V="vueuse-storage";function N(e,t,n,a={}){var i;const{flush:p="pre",deep:h=!0,listenToStorageChanges:l=!0,writeDefaults:c=!0,mergeDefaults:f=!1,shallow:g,window:b=R,eventFilter:s,onError:u=o=>{console.error(o)},initOnMounted:m}=a,k=(g?Y:S)(typeof t=="function"?t():t),w=T(()=>x(e));if(!n)try{n=he("getDefaultStorage",()=>{var o;return(o=R)==null?void 0:o.localStorage})()}catch(o){u(o)}if(!n)return k;const E=x(t),W=ge(E),O=(i=a.serializer)!=null?i:ke[W],{pause:L,resume:_}=ce(k,()=>I(k.value),{flush:p,deep:h,eventFilter:s});C(w,()=>A(),{flush:p}),b&&l&&fe(()=>{n instanceof Storage?M(b,"storage",A,{passive:!0}):M(b,V,H),m&&A()}),m||A();function J(o,d){if(b){const v={key:w.value,oldValue:o,newValue:d,storageArea:n};b.dispatchEvent(n instanceof Storage?new StorageEvent("storage",v):new CustomEvent(V,{detail:v}))}}function I(o){try{const d=n.getItem(w.value);if(o==null)J(d,null),n.removeItem(w.value);else{const v=O.write(o);d!==v&&(n.setItem(w.value,v),J(d,v))}}catch(d){u(d)}}function G(o){const d=o?o.newValue:n.getItem(w.value);if(d==null)return c&&E!=null&&n.setItem(w.value,O.write(E)),E;if(!o&&f){const v=O.read(d);return typeof f=="function"?f(v,E):W==="object"&&!Array.isArray(v)?{...E,...v}:v}else return typeof d!="string"?d:O.read(d)}function A(o){if(!(o&&o.storageArea!==n)){if(o&&o.key==null){k.value=E;return}if(!(o&&o.key!==w.value)){L();try{(o==null?void 0:o.newValue)!==O.write(k.value)&&(k.value=G(o))}catch(d){u(d)}finally{o?P(_):_()}}}}function H(o){A(o.detail)}return k}const r={auth:S(),user:S({}),token:S(""),refreshToken:S(""),tokenExpiry:S(null)},y={auth:S(),user:N("user",{}),token:N("token",""),refreshToken:N("refreshToken",""),tokenExpiry:N("tokenExpiry",null)};S(null);C(r.user,e=>{e&&typeof e=="object"&&Object.keys(e).forEach(t=>{y.user.value[t]=e[t]})},{deep:!0});r.auth.value=y.auth.value,r.user.value=y.user.value,r.token.value=y.token.value,r.refreshToken.value=y.refreshToken.value,r.tokenExpiry.value=y.tokenExpiry.value;const me=e=>{try{const n=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(n).split("").map(p=>"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)).join("")),i=JSON.parse(a);return i.exp?i.exp*1e3:null}catch(t){return console.error("Failed to decode token:",t),null}},be=()=>{const e=T({get:()=>{var s,u;return((u=(s=r==null?void 0:r.user)==null?void 0:s.value)==null?void 0:u.user_id)??""},set:()=>{}}),t=T({get:()=>{var s,u;return(s=r.token)!=null&&s.value?((u=r==null?void 0:r.user)==null?void 0:u.value)!=null&&typeof r.user.value=="object"&&Object.keys(r.user.value).length>0:!1},set:()=>{}}),n=T(()=>{var s,u;return(u=(s=r==null?void 0:r.user)==null?void 0:s.value)==null?void 0:u.isEmailVerified}),a=T(()=>{if(!r.tokenExpiry.value)return!1;const s=Date.now(),u=5*60*1e3;return s>=r.tokenExpiry.value-u}),i=()=>{localStorage.clear(),r.user.value={},r.token.value="",r.refreshToken.value="",r.auth.value=null,r.tokenExpiry.value=null},p=s=>{r.token.value=s,y.token.value=s;const u=me(s);u&&(r.tokenExpiry.value=u,y.tokenExpiry.value=u)},h=s=>{r.refreshToken.value=s,y.refreshToken.value=s};return{id:e,isLoggedIn:t,isEmailVerified:n,isTokenExpired:a,createUser:s=>{const{access_token:u,refresh_token:m,user:k}=s;p(u),h(m),y.user.value=k,r.user.value=k},...r,logOut:i,updateUser:s=>{const m={...r.user.value||{},...s};r.user.value=m,y.user.value=m},setToken:p,setRefreshToken:h,getAccessToken:()=>r.token.value,getRefreshToken:()=>r.refreshToken.value,getTokenExpiry:()=>r.tokenExpiry.value}};export{be as u};
