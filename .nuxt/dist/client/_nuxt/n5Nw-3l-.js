import{_ as ee}from"./D3m8EvAR.js";import{_ as te}from"./BsFiCVtJ.js";import{r as x,m as J,e as se,q as $,w as z,s as oe,o as p,a as e,c as m,d as V,h as U,F as S,B as T,t as f,n as L,z as O,b as h,T as P,x as I,k as q,g as le,j as ae,_ as ne}from"./-CC84MIu.js";import{u as re,a as E}from"./DY4jcAV6.js";import"./Dd8yx3qv.js";const ie=()=>{const g=x(!1),v=x([]),{showToast:c}=re(),j=async d=>{var i,n,u,a;g.value=!0;try{const o=await E.$_create_role(d);if(o.type!=="ERROR")return c({title:"Success",message:`Role '${d.role_type}' created successfully`,toastType:"success",duration:3e3}),!0;{const s=((u=(n=(i=o==null?void 0:o.data)==null?void 0:i.detail)==null?void 0:n[0])==null?void 0:u.msg)||((a=o==null?void 0:o.data)==null?void 0:a.error)||"Failed to create role";return c({title:"Error",message:s,toastType:"error",duration:3e3}),!1}}catch(o){return c({title:"Error",message:(o==null?void 0:o.message)||"Something went wrong",toastType:"error",duration:3e3}),!1}finally{g.value=!1}},_=async()=>{var d,i,n,u;g.value=!0;try{const a=await E.$_get_all_roles();if(a.type!=="ERROR")return v.value=a.data,a.data;{const o=((n=(i=(d=a==null?void 0:a.data)==null?void 0:d.detail)==null?void 0:i[0])==null?void 0:n.msg)||((u=a==null?void 0:a.data)==null?void 0:u.error)||"Failed to fetch roles";return c({title:"Error",message:o,toastType:"error",duration:3e3}),null}}catch(a){return c({title:"Error",message:(a==null?void 0:a.message)||"Something went wrong",toastType:"error",duration:3e3}),null}finally{g.value=!1}},B=async(d,i)=>{var n,u,a,o;g.value=!0;try{const s=await E.$_update_role(d,i);if(s.type!=="ERROR"){const w=v.value.findIndex(F=>F.role_type===d);return w!==-1&&(v.value[w]=s.data),c({title:"Success",message:`Role '${d}' updated successfully`,toastType:"success",duration:3e3}),s.data}else{const w=((a=(u=(n=s==null?void 0:s.data)==null?void 0:n.detail)==null?void 0:u[0])==null?void 0:a.msg)||((o=s==null?void 0:s.data)==null?void 0:o.error)||"Failed to update role";return c({title:"Error",message:w,toastType:"error",duration:3e3}),null}}catch(s){return c({title:"Error",message:(s==null?void 0:s.message)||"Something went wrong",toastType:"error",duration:3e3}),null}finally{g.value=!1}},D=async d=>{var i,n,u,a;g.value=!0;try{const o=await E.$_delete_role(d);if(o.type!=="ERROR")return v.value=v.value.filter(s=>s.role_type!==d),c({title:"Success",message:`Role '${d}' deleted successfully`,toastType:"success",duration:3e3}),!0;{const s=((u=(n=(i=o==null?void 0:o.data)==null?void 0:i.detail)==null?void 0:n[0])==null?void 0:u.msg)||((a=o==null?void 0:o.data)==null?void 0:a.error)||"Failed to delete role";return c({title:"Error",message:s,toastType:"error",duration:3e3}),!1}}catch(o){return c({title:"Error",message:(o==null?void 0:o.message)||"Something went wrong",toastType:"error",duration:3e3}),!1}finally{g.value=!1}},b=async d=>{var i,n,u,a;g.value=!0;try{const o=await E.$_assign_role(d);if(o.type!=="ERROR")return c({title:"Success",message:`Role '${d.role_type}' assigned successfully`,toastType:"success",duration:3e3}),!0;{const s=((u=(n=(i=o==null?void 0:o.data)==null?void 0:i.detail)==null?void 0:n[0])==null?void 0:u.msg)||((a=o==null?void 0:o.data)==null?void 0:a.error)||"Failed to assign role";return c({title:"Error",message:s,toastType:"error",duration:3e3}),!1}}catch(o){return c({title:"Error",message:(o==null?void 0:o.message)||"Something went wrong",toastType:"error",duration:3e3}),!1}finally{g.value=!1}};return J(async()=>{await _()}),{loading:g,roles:v,createRole:j,getAllRoles:_,updateRole:B,deleteRole:D,assignRole:b}},de={class:"min-h-screen"},ue={class:"px-4 sm:px-6 lg:px-8 py-6 sm:py-8"},ce={key:0,class:"flex items-center justify-center py-12"},pe={key:1,class:"bg-white rounded-lg shadow-sm border-[0.5px] border-gray-100 overflow-hidden"},fe={class:"block lg:hidden divide-y divide-gray-200"},ge={class:"flex justify-between items-start mb-2"},me={class:"font-medium text-gray-900"},xe={class:"text-sm text-gray-600 mt-1"},ve={class:"mt-2"},ye={class:"flex gap-2"},_e=["onClick"],he=["onClick"],be={class:"hidden lg:block overflow-x-auto border-[0.5px] border-gray-50"},we={class:"min-w-full divide-y-[0.5px] divide-gray-50"},ke={class:"bg-white divide-y-[0.5px] divide-gray-50"},Re={class:"px-6 py-6 whitespace-nowrap text-sm text-gray-900"},Ce={class:"px-6 py-6 whitespace-nowrap text-sm font-medium text-gray-900"},Ee={class:"px-6 py-6 text-sm text-gray-600"},Me={class:"px-6 py-6 whitespace-nowrap text-sm"},Ve={class:"px-6 py-6 whitespace-nowrap text-sm text-gray-600"},Se={class:"px-6 py-6 whitespace-nowrap text-sm"},Te={class:"flex gap-2"},je=["onClick"],Be=["onClick"],De={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Fe={class:"inline-block w-full max-w-2xl my-8 overflow-hidden text-left align-middle transition-all transform bg-white rounded-lg shadow-xl"},$e={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},ze={class:"flex items-center gap-3"},Ue={class:"text-lg font-semibold text-gray-900"},Ae={class:"px-6 py-6 space-y-6 max-h-[70vh] overflow-y-auto"},Ne={class:"space-y-3"},He={class:"flex justify-between items-start mb-3"},Le=["onClick"],Oe={class:"space-y-2"},Pe={class:"flex flex-wrap gap-2"},Ie=["value","onUpdate:modelValue"],qe={class:"ml-2 text-sm"},Je={class:"flex justify-end gap-3 px-6 py-4 bg-gray-25 border-t border-gray-100"},Ye=["disabled"],Ge={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},Ke={class:"inline-block w-full max-w-md my-8 overflow-hidden text-left align-middle transition-all transform bg-white rounded-lg shadow-xl"},Qe={class:"px-6 py-8 text-center"},We={class:"text-gray-600"},Xe={class:"font-semibold"},Ze={class:"flex justify-between items-center w-full gap-3 px-6 py-4 bg-gray-50"},et=["disabled"],tt=se({__name:"manage-role",setup(g){const{loading:v,roles:c,createRole:j,getAllRoles:_,updateRole:B,deleteRole:D}=ie(),b=x(!1),d=x(!1),i=x(!1),n=x(!1),u=x(null),a=x(null),o=["create","read","update","delete","write","export","submit"],s=x({role_type:"",role_function:"",role_function_rights:[],expiration_date:null,status:"Enabled"});J(async()=>{await _()});const w=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),F=()=>{i.value=!1,N(),b.value=!0},A=r=>{i.value=!0,a.value=r.role_type,s.value={role_type:r.role_type,role_function:r.role_function,role_function_rights:JSON.parse(JSON.stringify(r.role_function_rights)),expiration_date:r.expiration_date,status:r.status},b.value=!0},k=()=>{b.value=!1,i.value=!1,a.value=null,N()},N=()=>{s.value={role_type:"",role_function:"",role_function_rights:[{function_name:"",rights:[]}],expiration_date:null,status:"Enabled"}},H=r=>{u.value=r,d.value=!0},C=()=>{d.value=!1,u.value=null},Y=()=>{s.value.role_function_rights.push({function_name:"",rights:[]})},G=r=>{s.value.role_function_rights.splice(r,1)},K=async()=>{if(!s.value.role_type.trim()){alert("Please enter a role type");return}if(!s.value.role_function.trim()){alert("Please enter a role function");return}if(s.value.role_function_rights.length===0){alert("Please add at least one function right");return}for(const r of s.value.role_function_rights){if(!r.function_name.trim()){alert("Please fill in all function names");return}if(r.rights.length===0){alert(`Please select at least one right for ${r.function_name}`);return}}if(n.value=!0,i.value&&a.value){const r={role_function:s.value.role_function,role_function_rights:s.value.role_function_rights,expiration_date:s.value.expiration_date||null,status:s.value.status},t=await B(a.value,r);n.value=!1,t&&(k(),await _())}else{const r={role_type:s.value.role_type,role_function:s.value.role_function,role_function_rights:s.value.role_function_rights,expiration_date:s.value.expiration_date||null,status:s.value.status},t=await j(r);n.value=!1,t&&(k(),await _())}},Q=async()=>{if(!u.value)return;n.value=!0;const r=await D(u.value.role_type);n.value=!1,r&&(C(),await _())};return(r,t)=>{const M=ee,W=te,X=oe;return p(),$(X,{name:"dashboard"},{default:z(()=>[e("div",de,[e("div",ue,[e("div",{class:"flex justify-between items-center"},[t[5]||(t[5]=e("div",{class:"mb-6 sm:mb-8"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Role Management"),e("p",{class:"mt-2 text-sm sm:text-base text-gray-600"}," Define and manage access roles across iCCaREPO sites and modules. ")],-1)),e("div",{class:"mb-6"},[e("button",{onClick:F,class:"flex items-center gap-2 px-4 py-2 bg-[#005B8F] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"},t[4]||(t[4]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),V(" Add New Role ")]))])]),U(v)?(p(),m("div",ce,t[6]||(t[6]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#005B8F]"},null,-1)]))):(p(),m("div",pe,[e("div",fe,[(p(!0),m(S,null,T(U(c),l=>(p(),m("div",{key:l.role_type,class:"p-4 hover:bg-gray-50"},[e("div",ge,[e("div",null,[e("div",me,f(l.role_type),1),e("div",xe,f(l.role_function),1),e("div",ve,[e("span",{class:L(["px-2 py-1 text-xs rounded-full",l.status==="Enabled"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},f(l.status),3)])]),e("div",ye,[e("button",{onClick:R=>A(l),class:"text-blue-600 hover:text-blue-800"},t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,_e),e("button",{onClick:R=>H(l),class:"text-red-600 hover:text-red-800"},t[8]||(t[8]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)]),8,he)])])]))),128))]),e("div",be,[e("table",we,[t[11]||(t[11]=e("thead",{class:"bg-gray-25"},[e("tr",null,[e("th",{class:"px-6 py-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," SN "),e("th",{class:"px-6 py-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Role Type "),e("th",{class:"px-6 py-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Function "),e("th",{class:"px-6 py-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),e("th",{class:"px-6 py-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Expiration "),e("th",{class:"px-6 py-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",ke,[(p(!0),m(S,null,T(U(c),(l,R)=>(p(),m("tr",{key:l.role_type,class:"hover:bg-gray-25"},[e("td",Re,f(R+1),1),e("td",Ce,f(l.role_type),1),e("td",Ee,f(l.role_function),1),e("td",Me,[e("span",{class:L(["px-3 py-1 rounded-full text-xs font-medium",l.status==="Enabled"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},f(l.status),3)]),e("td",Ve,f(l.expiration_date?w(l.expiration_date):"No Expiration"),1),e("td",Se,[e("div",Te,[e("button",{onClick:y=>A(l),class:"text-blue-600 hover:text-blue-800",title:"Edit Role"},t[9]||(t[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,je),e("button",{onClick:y=>H(l),class:"text-red-600 hover:text-red-800",title:"Delete Role"},t[10]||(t[10]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)]),8,Be)])])]))),128))])])])]))]),(p(),$(O,{to:"body"},[h(P,{name:"modal"},{default:z(()=>[b.value?(p(),m("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:q(k,["self"])},[e("div",De,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-900 bg-opacity-75",onClick:k}),e("div",Fe,[e("div",$e,[e("div",ze,[e("button",{onClick:k,class:"text-gray-400 hover:text-gray-600"},t[12]||(t[12]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),e("h3",Ue,f(i.value?"Edit Role":"Add New Role"),1)])]),e("div",Ae,[e("div",null,[h(M,{modelValue:s.value.role_type,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.role_type=l),label:"Role Type",type:"text",disabled:i.value,required:""},null,8,["modelValue","disabled"])]),e("div",null,[h(M,{modelValue:s.value.role_function,"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.role_function=l),label:"Role Function",rows:3,required:""},null,8,["modelValue"])]),e("div",null,[e("div",Ne,[(p(!0),m(S,null,T(s.value.role_function_rights,(l,R)=>(p(),m("div",{key:R,class:"border border-gray-200 rounded-lg p-4"},[e("div",He,[h(M,{modelValue:l.function_name,"onUpdate:modelValue":y=>l.function_name=y,type:"text",label:"Function Rights",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),e("button",{onClick:y=>G(R),class:"text-red-600 hover:text-red-800",type:"button"},t[13]||(t[13]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,Le)]),e("div",Oe,[t[14]||(t[14]=e("label",{class:"text-xs text-gray-600"},"Rights:",-1)),e("div",Pe,[(p(),m(S,null,T(o,y=>e("label",{key:y,class:"inline-flex items-center"},[le(e("input",{type:"checkbox",value:y,"onUpdate:modelValue":Z=>l.rights=Z,class:"custom-checkbox"},null,8,Ie),[[ae,l.rights]]),e("span",qe,f(y),1)])),64))])])]))),128))]),e("button",{onClick:Y,type:"button",class:"mt-3 text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1"},t[15]||(t[15]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),V(" Add Function Right ")]))]),e("div",null,[h(W,{options:["Enabled","Disabled"],modelValue:s.value.status,"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.status=l),label:"Status"},null,8,["modelValue"])]),e("div",null,[h(M,{modelValue:s.value.expiration_date,"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.expiration_date=l),type:"date",label:"Expiration Date (Optional)"},null,8,["modelValue"])])]),e("div",Je,[e("button",{onClick:k,type:"button",class:"px-6 py-2.5 text-sm font-medium text-gray-700 bg-white border-[0.5px] border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancel "),e("button",{onClick:K,disabled:n.value,type:"button",class:"px-6 py-2.5 text-sm font-medium text-white bg-[#005B8F] rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50"},f(n.value?"Saving...":i.value?"Update Role":"Save Role"),9,Ye)])])])])):I("",!0)]),_:1})])),(p(),$(O,{to:"body"},[h(P,{name:"modal"},{default:z(()=>{var l;return[d.value?(p(),m("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:q(C,["self"])},[e("div",Ge,[e("div",{class:"fixed inset-0 transition-opacity bg-gray-900 bg-opacity-75",onClick:C}),e("div",Ke,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},[e("div",{class:"flex items-center gap-3"},[e("button",{onClick:C,class:"text-gray-400 hover:text-gray-600"},t[16]||(t[16]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),t[17]||(t[17]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete Role",-1))])]),e("div",Qe,[t[20]||(t[20]=e("div",{class:"flex justify-center mb-4"},[e("div",{class:"w-16 h-16 flex items-center justify-center bg-red-100 rounded-full"},[e("svg",{class:"w-10 h-10 text-red-600",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})])])],-1)),t[21]||(t[21]=e("h3",{class:"text-xl font-bold text-gray-900 mb-2"},"Delete Role?",-1)),e("p",We,[t[18]||(t[18]=V(" Are you sure you want to delete the '")),e("span",Xe,f((l=u.value)==null?void 0:l.role_type),1),t[19]||(t[19]=V("' role? This action cannot be undone. "))])]),e("div",Ze,[e("button",{onClick:C,class:"px-6 py-3 text-sm w-full font-medium text-sm text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"}," Cancel "),e("button",{onClick:Q,disabled:n.value,class:"px-6 py-3 text-sm w-full font-medium text-sm text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50"},f(n.value?"Deleting...":"Yes, Delete"),9,et)])])])])):I("",!0)]}),_:1})]))])]),_:1})}}}),rt=ne(tt,[["__scopeId","data-v-b40319b1"]]);export{rt as default};
