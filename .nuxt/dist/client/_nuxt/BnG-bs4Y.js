import{e as C,c as d,o as s,a as t,x as T,F as O,B as P,n as b,t as p,k as L,_ as N,d as V,f as H,r as $,p as z,m as G,C as q,q as U,w as J,s as W,h as w,b as Y}from"./-CC84MIu.js";import{G as j,u as K}from"./DY4jcAV6.js";import{s as Q}from"./x_rD_Ya3.js";import"./Dd8yx3qv.js";const X={class:"bg-white rounded-xl shadow-sm border border-gray-50 overflow-hidden"},Z={key:0,class:"flex items-center justify-center py-12"},tt={key:1,class:"divide-y divide-gray-100 max-h-[calc(100vh-300px)] overflow-y-auto"},et=["onClick"],ot={class:"flex items-start gap-3"},nt={class:"flex-shrink-0 mt-1"},at={class:"flex-1 min-w-0"},st={class:"flex items-start justify-between gap-2 mb-1"},it={key:0,class:"flex-shrink-0"},rt={class:"text-sm text-gray-600 line-clamp-2 mb-2"},lt={class:"flex items-center justify-between"},dt={class:"text-xs text-gray-500"},ct={class:"flex items-center gap-2"},ut=["onClick"],ft=["onClick"],mt={key:0,class:"px-6 py-12 text-center"},gt=C({__name:"NotificationList",props:{notifications:{},selectedId:{},loading:{type:Boolean}},emits:["select","mark-read","mark-unread","refresh"],setup(g){const f=a=>({urgent:"bg-red-500",high:"bg-orange-500",normal:"bg-gray-400"})[a]||"bg-gray-400",l=a=>{const e=new Date(a),i=Math.floor((new Date().getTime()-e.getTime())/1e3);return i<60?"Just now":i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:i<604800?`${Math.floor(i/86400)}d ago`:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return(a,e)=>(s(),d("div",X,[e[3]||(e[3]=t("div",{class:"px-6 py-4 border-b border-gray-100"},[t("h2",{class:"text-lg font-semibold text-gray-900"},"Notifications")],-1)),a.loading&&!a.notifications.length?(s(),d("div",Z,e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#005B8F]"},null,-1)]))):(s(),d("div",tt,[(s(!0),d(O,null,P(a.notifications,o=>(s(),d("div",{key:o.notification_id,onClick:i=>a.$emit("select",o),class:b(["px-6 py-4 cursor-pointer transition-colors hover:bg-gray-50",a.selectedId===o.notification_id&&"bg-blue-50",!o.read&&"bg-blue-25"])},[t("div",ot,[t("div",nt,[t("div",{class:b(["w-2 h-2 rounded-full",f(o.priority)])},null,2)]),t("div",at,[t("div",st,[t("h3",{class:b(["text-sm font-medium",o.read?"text-gray-600":"text-gray-900"])},p(o.title),3),o.read?T("",!0):(s(),d("div",it,e[1]||(e[1]=[t("div",{class:"w-2 h-2 bg-[#005B8F] rounded-full"},null,-1)])))]),t("p",rt,p(o.message),1),t("div",lt,[t("span",dt,p(l(o.timestamp)),1),t("div",ct,[o.read?(s(),d("button",{key:1,onClick:L(i=>a.$emit("mark-unread",o.notification_id),["stop"]),class:"text-xs text-gray-600 hover:text-gray-800 font-medium"}," Mark as unread ",8,ft)):(s(),d("button",{key:0,onClick:L(i=>a.$emit("mark-read",o.notification_id),["stop"]),class:"text-xs text-blue-600 hover:text-blue-800 font-medium"}," Mark as read ",8,ut))])])])])],10,et))),128)),a.notifications.length===0?(s(),d("div",mt,e[2]||(e[2]=[t("svg",{class:"w-12 h-12 text-gray-300 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1),t("p",{class:"text-sm text-gray-500"},"No notifications",-1)]))):T("",!0)]))]))}}),pt=N(gt,[["__scopeId","data-v-34ff5cae"]]),vt={class:"bg-white rounded-xl shadow-sm border border-gray-50 overflow-hidden"},_t={class:"px-6 py-4 border-b border-gray-100 flex items-center justify-between"},yt={class:"flex items-center gap-3"},ht={class:"flex items-center gap-2"},xt={class:"px-6 py-6 max-h-[calc(100vh-300px)] overflow-y-auto"},bt={class:"text-2xl font-bold text-gray-900 mb-2"},kt={class:"flex items-center gap-2 text-sm text-gray-500 mb-6"},wt={class:"prose prose-sm max-w-none mb-6"},$t={class:"text-gray-700 leading-relaxed whitespace-pre-wrap"},Ct={class:"mb-6"},Nt={class:"inline-flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm"},Mt=C({__name:"NotificationDetail",props:{notification:{}},emits:["mark-read","mark-unread","close"],setup(g){const f=e=>({urgent:"bg-red-100 text-red-700",high:"bg-orange-100 text-orange-700",normal:"bg-gray-100 text-gray-700"})[e]||"bg-gray-100 text-gray-700",l=e=>e.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" "),a=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return(e,o)=>(s(),d("div",vt,[t("div",_t,[t("div",yt,[t("span",{class:b(["px-3 py-1 rounded-full text-xs font-semibold",f(e.notification.priority)])},p(e.notification.priority.toUpperCase()),3),t("span",{class:b(["px-3 py-1 rounded-full text-xs font-medium",e.notification.read?"bg-gray-100 text-gray-700":"bg-blue-100 text-blue-700"])},p(e.notification.read?"Read":"Unread"),3)]),t("div",ht,[e.notification.read?(s(),d("button",{key:1,onClick:o[1]||(o[1]=i=>e.$emit("mark-unread",e.notification.notification_id)),class:"px-3 py-1.5 text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors"}," Mark as unread ")):(s(),d("button",{key:0,onClick:o[0]||(o[0]=i=>e.$emit("mark-read",e.notification.notification_id)),class:"px-3 py-1.5 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors"}," Mark as read ")),t("button",{onClick:o[2]||(o[2]=i=>e.$emit("close")),class:"p-2 text-gray-400 hover:text-gray-600 transition-colors"},o[3]||(o[3]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])]),t("div",xt,[t("h2",bt,p(e.notification.title),1),t("div",kt,[o[4]||(o[4]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("span",null,p(a(e.notification.timestamp)),1)]),t("div",wt,[t("p",$t,p(e.notification.message),1)]),t("div",Ct,[t("span",Nt,[o[5]||(o[5]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})],-1)),V(" "+p(l(e.notification.notification_type)),1)])])])]))}}),Rt=N(Mt,[["__scopeId","data-v-d60675a3"]]),Bt={class:"bg-white rounded-xl shadow-sm border border-gray-50 overflow-hidden"},Ut=C({__name:"EmptyState",setup(g){return(f,l)=>(s(),d("div",Bt,l[0]||(l[0]=[H('<div class="flex flex-col items-center justify-center py-16 px-6 text-center" data-v-71f690ee><div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6" data-v-71f690ee><svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-71f690ee><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" data-v-71f690ee></path></svg></div><h3 class="text-lg font-semibold text-gray-900 mb-2" data-v-71f690ee> No notification selected </h3><p class="text-sm text-gray-600 max-w-sm" data-v-71f690ee> Select a notification from the list to view its details </p></div>',1)])))}}),jt=N(Ut,[["__scopeId","data-v-71f690ee"]]),S={$_get_notification_feed:g=>j.get("/notification/feed",{params:g}),$_mark_notification_read:g=>j.post(`/notification/feed/${g}/mark-read`),$_get_unread_count:()=>j.get("/notification/feed/unread/count")},St=()=>{const g=$(!1),f=$([]),l=$(0),{showToast:a}=K();return{loading:g,notifications:f,unreadCount:l,getNotificationFeed:async r=>{var m,v,h,_;g.value=!0;try{const n=await S.$_get_notification_feed(r);if(n.type!=="ERROR")return f.value=n.data,n.data;{const y=((h=(v=(m=n==null?void 0:n.data)==null?void 0:m.detail)==null?void 0:v[0])==null?void 0:h.msg)||((_=n==null?void 0:n.data)==null?void 0:_.error)||"Failed to fetch notifications";return a({title:"Error",message:y,toastType:"error",duration:3e3}),null}}catch(n){return a({title:"Error",message:(n==null?void 0:n.message)||"Something went wrong",toastType:"error",duration:3e3}),null}finally{g.value=!1}},markNotificationRead:async r=>{var m,v,h,_;try{const n=await S.$_mark_notification_read(r);if(n.type!=="ERROR"){const y=f.value.findIndex(M=>M.notification_id===r);return y!==-1&&(f.value[y].read=!0),l.value>0&&l.value--,!0}else{const y=((h=(v=(m=n==null?void 0:n.data)==null?void 0:m.detail)==null?void 0:v[0])==null?void 0:h.msg)||((_=n==null?void 0:n.data)==null?void 0:_.error)||"Failed to mark notification as read";return a({title:"Error",message:y,toastType:"error",duration:3e3}),!1}}catch(n){return a({title:"Error",message:(n==null?void 0:n.message)||"Something went wrong",toastType:"error",duration:3e3}),!1}},getUnreadCount:async()=>{try{const r=await S.$_get_unread_count();return r.type!=="ERROR"?(l.value=r.data.unread_count,r.data.unread_count):null}catch{return null}}}},Tt={class:"min-h-screen"},Et={class:"flex"},Ft={class:"flex-1 p-4 md:p-6 lg:p-8"},Lt={class:""},Vt={class:"mb-6 flex justify-between items-center"},Dt={class:"flex items-center gap-3"},It={key:0,class:"px-3 py-1.5 bg-red-100 text-red-700 rounded-full text-sm font-semibold"},At=["disabled"],Ot={key:0,class:"flex items-center justify-center py-12"},Pt={key:1,class:"grid grid-cols-1 lg:grid-cols-12 gap-6"},Ht={class:"lg:col-span-5 xl:col-span-4"},zt={class:"lg:col-span-7 xl:col-span-8"},Gt=C({__name:"notification",setup(g){const{loading:f,notifications:l,unreadCount:a,getNotificationFeed:e,markNotificationRead:o,getUnreadCount:i}=St(),r=$(null),m=$(!1),v=$(null),h=z(()=>m.value?l.value.filter(u=>!u.read):l.value);G(async()=>{await _(),await i(),D()}),q(()=>{I()});const _=async()=>{await e({limit:50,offset:0,unread_only:m.value})},n=async()=>{await _(),await i()},y=async()=>{m.value=!m.value,await _()},M=async u=>{r.value=u,u.read||await R(u.notification_id)},R=async u=>{var x;if(await o(u)){const k=l.value.find(B=>B.notification_id===u);k&&(k.read=!0),((x=r.value)==null?void 0:x.notification_id)===u&&(r.value.read=!0),await i()}},E=async u=>{var x;const c=l.value.find(k=>k.notification_id===u);c&&(c.read=!1,((x=r.value)==null?void 0:x.notification_id)===u&&(r.value.read=!1),a.value++)},D=()=>{v.value=Q(async()=>{await i(),l.value.filter(c=>!c.read).length!==a.value&&await _()},3e4)},I=()=>{v.value&&(clearInterval(v.value),v.value=null)};return(u,c)=>{const x=pt,k=Rt,B=jt,A=W;return s(),U(A,{name:"dashboard"},{default:J(()=>{var F;return[t("div",Tt,[t("div",Et,[t("main",Ft,[t("div",Lt,[t("div",Vt,[c[3]||(c[3]=t("div",null,[t("h1",{class:"text-xl font-bold text-gray-900"},"Notifications"),t("p",{class:"text-sm text-gray-600 mt-1"},"Stay informed about your iCCaREPO activities and critical alerts.")],-1)),t("div",Dt,[w(a)>0?(s(),d("div",It,p(w(a))+" Unread ",1)):T("",!0),t("button",{onClick:y,class:b(["px-4 py-2 rounded-lg text-sm font-medium transition-colors",m.value?"bg-[#005B8F] text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"])},p(m.value?"All":"Unread Only"),3),t("button",{onClick:n,disabled:w(f),class:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 text-sm font-medium flex items-center gap-2"},[(s(),d("svg",{class:b(["w-4 h-4",w(f)&&"animate-spin"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},c[1]||(c[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]),2)),c[2]||(c[2]=V(" Refresh "))],8,At)])]),w(f)&&!u.notifications.length?(s(),d("div",Ot,c[4]||(c[4]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#005B8F]"},null,-1)]))):(s(),d("div",Pt,[t("div",Ht,[Y(x,{notifications:h.value,"selected-id":(F=r.value)==null?void 0:F.notification_id,loading:w(f),onSelect:M,onMarkRead:R,onMarkUnread:E,onRefresh:n},null,8,["notifications","selected-id","loading"])]),t("div",zt,[r.value?(s(),U(k,{key:0,notification:r.value,onMarkRead:R,onMarkUnread:E,onClose:c[0]||(c[0]=qt=>r.value=null)},null,8,["notification"])):(s(),U(B,{key:1}))])]))])])])])]}),_:1})}}}),Qt=N(Gt,[["__scopeId","data-v-910b24dc"]]);export{Qt as default};
